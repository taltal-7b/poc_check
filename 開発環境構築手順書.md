# プロジェクト管理システム - セットアップガイド（まっさらな状態から）

このドキュメントでは、Gitリポジトリをクローンしてからローカル環境を構築するまでの手順を説明します。

## 📋 目次

1. [前提条件](#前提条件)
2. [リポジトリのクローン](#リポジトリのクローン)
3. [依存関係のインストール](#依存関係のインストール)
4. [データベースのセットアップ](#データベースのセットアップ)
5. [環境変数の設定](#環境変数の設定)
6. [初期データの投入](#初期データの投入)
7. [アプリケーションの起動](#アプリケーションの起動)
8. [動作確認](#動作確認)

---

## 前提条件

以下のソフトウェアがインストールされている必要があります：

### 必須ソフトウェア

1. **Git** (2.0以上)
   - ダウンロード: https://git-scm.com/downloads
   - インストール確認:
     ```bash
     git --version
     ```

2. **Node.js** (18.x以上)
   - ダウンロード: https://nodejs.org/
   - 推奨: LTS版（20.x以上）
   - インストール確認:
     ```bash
     node --version
     npm --version
     ```

3. **PostgreSQL** (14.x以上、推奨: 16.x)
   - ダウンロード: https://www.postgresql.org/download/
   - Windows: https://www.postgresql.org/download/windows/
   - macOS: `brew install postgresql@16`
   - Linux: `sudo apt-get install postgresql-16` (Ubuntu/Debian)
   - インストール確認:
     ```bash
     psql --version
     ```

---

## リポジトリのクローン

### 1. リポジトリをクローン

リポジトリURLは
┌────────────────────────────────────────────────┐
│ Clone                                          │
│                                                │
│  HTTPS   SSH   GitHub CLI                      │
│  ─────                                         │
│                                                │
│  https://github.com/foobar/poc_check.git [⧉]  │　←このURLをコピー
│                                                │
│  Open with GitHub Desktop                      │
│  Download ZIP                                  │
└────────────────────────────────────────────────┘


```bash
# リポジトリのURLを指定してクローン
git clone <repository-url> poc_check
cd poc_check
```

**例:**
```bash
git clone https://github.com/your-username/project-management-system.git poc_check
cd poc_check
```

---

## 依存関係のインストール

### 1. ルートディレクトリで依存関係をインストール

```bash
# ルートディレクトリで実行
npm install
```

このコマンドは、ルート、バックエンド、フロントエンドのすべての依存関係をインストールします。

---

## データベースのセットアップ

### データベースの作成

PostgreSQLに接続してデータベースを作成します：

```bash
# PostgreSQLに接続（デフォルトユーザー: postgres）
psql -U postgres
```

接続後、以下のSQLを実行：

```sql
-- データベースを作成
CREATE DATABASE project_management;

-- 専用ユーザーを作成（オプション、推奨）
CREATE USER pm_user WITH ENCRYPTED PASSWORD 'your_secure_password';

-- 権限を付与
GRANT ALL PRIVILEGES ON DATABASE project_management TO pm_user;

-- PostgreSQLから抜ける
\q
```

---

**注意**: PostgreSQLが起動していることを確認してください。

## 環境変数の設定

### 1. バックエンドの環境変数設定

`backend/.env` ファイルを作成します：

#### Windows (PowerShell)
```powershell
# backendディレクトリに移動
cd backend

# .envファイルを作成
@"
# Application
NODE_ENV=development
PORT=3000
FRONTEND_URL=http://localhost:5173

# Database
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=your_password
DB_DATABASE=project_management

# JWT
JWT_SECRET=your-jwt-secret-key-change-this-in-production-$(Get-Random)
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-refresh-token-secret-change-this-in-production-$(Get-Random)
JWT_REFRESH_EXPIRES_IN=30d

# Session
SESSION_SECRET=your-session-secret-change-this-in-production-$(Get-Random)

# Two-Factor Authentication
TWOFA_ENABLED=1
TOTP_ISSUER=ProjectManager
APP_NAME=Project Management System

# Email (オプション)
MAIL_FROM=noreply@example.com
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your_email@example.com
SMTP_PASS=your_email_password
SMTP_SECURE=false

# Password Policy
PASSWORD_MIN_LENGTH=8

# Application
HOST_NAME=localhost:3000
PROTOCOL=http
APP_TITLE=Project Management System
DEFAULT_LANGUAGE=ja
"@ | Out-File -FilePath .env -Encoding utf8

cd ..
```

#### macOS/Linux
```bash
cd backend

cat > .env << 'EOF'
# Application
NODE_ENV=development
PORT=3000
FRONTEND_URL=http://localhost:5173

# Database
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=your_password
DB_DATABASE=project_management

# JWT
JWT_SECRET=your-jwt-secret-key-change-this-in-production
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-refresh-token-secret-change-this-in-production
JWT_REFRESH_EXPIRES_IN=30d

# Session
SESSION_SECRET=your-session-secret-change-this-in-production

# Two-Factor Authentication
TWOFA_ENABLED=1
TOTP_ISSUER=ProjectManager
APP_NAME=Project Management System

# Email (オプション)
MAIL_FROM=noreply@example.com
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your_email@example.com
SMTP_PASS=your_email_password
SMTP_SECURE=false

# Password Policy
PASSWORD_MIN_LENGTH=8

# Application
HOST_NAME=localhost:3000
PROTOCOL=http
APP_TITLE=Project Management System
DEFAULT_LANGUAGE=ja
EOF

cd ..
```

**重要**: `DB_PASSWORD`、`JWT_SECRET`、`JWT_REFRESH_SECRET`、`SESSION_SECRET` を実際の値に変更してください。

### 2. フロントエンドの環境変数設定

`frontend/.env` ファイルを作成します：

#### Windows (PowerShell)
```powershell
cd frontend

@"
VITE_API_URL=http://localhost:3000/api
"@ | Out-File -FilePath .env -Encoding utf8

cd ..
```

#### macOS/Linux
```bash
cd frontend

echo "VITE_API_URL=http://localhost:3000/api" > .env

cd ..
```

**重要**: `DB_PASSWORD`、`JWT_SECRET`、`JWT_REFRESH_SECRET`、`SESSION_SECRET` を実際の値に変更してください。

---

## 初期データの投入

基本的なロール、ステータス、優先度、管理者ユーザーなどの初期データを投入します：

```bash
cd backend
npm run seed
cd ..
```

これにより、デフォルト管理者ユーザー（login: `admin`, password: `admin123`）と基本的なマスターデータが作成されます。

**⚠️ 初回ログイン後、必ずパスワードを変更してください！**

---

## アプリケーションの起動

ルートディレクトリから、バックエンドとフロントエンドを同時に起動：

```bash
npm run dev
```

**アクセスURL:**
- フロントエンド: http://localhost:5173
- バックエンドAPI: http://localhost:3000/api

---

## 動作確認

1. ブラウザで http://localhost:5173 にアクセス
2. 以下の認証情報でログイン：
   - **ログイン名**: `admin`
   - **パスワード**: `admin123`
3. **初回ログイン後、必ずパスワードを変更してください**

---

**セットアップ完了！🎉**
